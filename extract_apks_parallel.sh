#!/bin/bash

#
# This script calls the extract_apk.sh script many times in parallel
# for each of the sorted applications to unpack apk files and parse
# their contents.
#

original_dir=$(pwd)
for dir in malicious_apk benign_apk; do
  echo "Entering $dir"
  cd $dir
  rm -f valid_apks.txt
  rm -f malformed_xml.txt
  rm -f malformed_dex.txt
  cpus=$( ls -d /sys/devices/system/cpu/cpu[[:digit:]]* | wc -w )
  find `pwd` -type f -name "*.apk" | xargs --max-args=1 --max-procs=$cpus ../extract_apk.sh
  cd $original_dir
done
