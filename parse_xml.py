#!/usr/bin/python3

# This script reads the AndroidManifest.xml files in the malicous_apk
# and benign_apk folders and copies the requested permissions into a
# CSV for later analysis

import os
import defusedxml

def main():
    for directory in ['benign_apk', 'malicious_apk']:
        os.chdir(directory)
        valid_apks = []
        if os.path.isfile('valid_apks.txt'):
            with open('valid_apks.txt') as f:
                valid_apks.append([line.strip() for line in f.readlines()])
        malformed_xml = []
        if os.path.isfile('malformed_xml.txt'):
            with open('malformed_xml.txt') as f:
                malformed_xml.append([line.strip() for line in f.readlines()])
        for filename in valid_apks:
            if filename not in malformed_xml:
                os.chdir(filename[:-4])
                with open(filename) as xml_file:
                    et = defusedxml.ElementTree.parse(xml_file)
                    #TODO
                os.chdir(os.pardir)
        os.chdir(os.pardir)

if __name__=='__main__':
    main()
